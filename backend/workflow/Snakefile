rule TenetInput:
    input:
        h5ad="user/{userName}/data/{fileName}"
    output:
        expMatrix="user/{userName}/result/{optionFileName}_TenetInput_{fileName}_expMatrix.csv",
        pseudotime="user/{userName}/result/{optionFileName}_TenetInput_{fileName}_pseudotime.csv",
        cellSelect="user/{userName}/result/{optionFileName}_TenetInput_{fileName}_cellSelect.csv"
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TenetInput.py {annoOfInterest} {pseudoOfInterest} {clustersOfInterest} {geneList} {selectedIndices}"

rule Tenet:
    input:
        expMatrix="user/{userName}/result/{optionFileName}_TenetInput_{fileName}_expMatrix.csv",
        pseudotime="user/{userName}/result/{optionFileName}_TenetInput_{fileName}_pseudotime.csv",
        cellSelect="user/{userName}/result/{optionFileName}_TenetInput_{fileName}_cellSelect.csv"
    output:
        resultMatrix="user/{userName}/result/{optionFileName}_Tenet_{fileName}_resultMatrix.txt"
    shell:
        "/app/workflow/script/TENET/TENET {input.expMatrix} {numOfThreads} {input.pseudotime} {input.cellSelect} {historyLength} {output.result} {userName}"

rule TenetTF:
    input:
        expMatrix="user/{userName}/result/{optionFileName}_TenetInput_{fileName}_expMatrix.csv",
        pseudotime="user/{userName}/result/{optionFileName}_TenetInput_{fileName}_pseudotime.csv",
        cellSelect="user/{userName}/result/{optionFileName}_TenetInput_{fileName}_cellSelect.csv"
    output:
        resultMatrix="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_resultMatrix.txt"
    shell:
        "/app/workflow/script/TENET/TENET_TF {input.expMatrix} {numOfThreads} {input.pseudotime} {input.cellSelect} {historyLength} {species} {output.result} {userName}"

rule ReconstructionGRNFdr:
    input:
        resultMatrix="user/{userName}/result/{optionFileName}_Tenet_{fileName}_resultMatrix.txt"
    output:
        resultMatrixFdr="user/{userName}/result/{optionFileName}_Tenet_{fileName}_result_matrix.fdr{cutoffForFdr}.sif"
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/makeGRN.py {cutoffForFdr} {input.resultMatrix} {output.result}"

rule ReconstructionGRNFdrTF:
    input:
        resultMatrix="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_resultMatrix.txt"
    output:
        result="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_result_matrix.fdr{cutoffForFdr}.sif"
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/makeGRNbyTF.py {species} {cutoffForFdr} {input.resultMatrix} {output.result}"

rule ReconstructionGRNNumLinks:
    input:
        resultMatrix="user/{userName}/result/{optionFileName}_Tenet_{fileName}_resultMatrix.txt"
    output:
        result="user/{userName}/result/{optionFileName}_Tenet_{fileName}_result_matrix.NumberOfLinks{numOfLinks}.sif"
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/makeGRNsameNumberOfLinks.py {numOfLinks} {input.resultMatrix} {output.result}"

rule ReconstructionGRNNumLinksTF:
    input:
        resultMatrix="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_resultMatrix.txt"
    output:
        result="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_result_matrix.NumberOfLinks{numOfLinks}.sif"
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/makeGRNbyTFsameNumberOfLinks.py {species} {numOfLinks} {input.resultMatrix} {output.result}"

rule TrimmingIndirectEdgesFdr:
    input:
        fdr="user/{userName}/result/{optionFileName}_Tenet_{fileName}_result_matrix.fdr{cutoffForFdr}.sif",
    output:
        fdrTrim="user/{userName}/result/{optionFileName}_Tenet_{fileName}_result_matrix.fdr{cutoffForFdr}.trimIndirect{trimmingIndirectEdges}.sif",
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/trim_indirect.py {input.fdr} {trimmingIndirectEdges} {output.fdrTrim}"

rule TrimmingIndirectEdgesNumLinks:
    input:
        numLinks="user/{userName}/result/{optionFileName}_Tenet_{fileName}_result_matrix.NumberOfLinks{numOfLinks}.sif"
    output:
        numLinksTrim="user/{userName}/result/{optionFileName}_Tenet_{fileName}_result_matrix.NumberOfLinks{numOfLinks}.trimIndirect{trimmingIndirectEdges}.sif"
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/trim_indirect.py {input.numLinks} {trimmingIndirectEdges} {output.numLinksTrim}"

rule TrimmingIndirectEdgesFdrTF:
    input:
        fdr="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_result_matrix.fdr{cutoffForFdr}.sif",
    output:
        fdrTrim="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_result_matrix.fdr{cutoffForFdr}.trimIndirect{trimmingIndirectEdges}.sif",
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/trim_indirect.py {input.fdr} {trimmingIndirectEdges} {output.fdrTrim}"

rule TrimmingIndirectEdgesNumLinksTF:
    input:
        numLinks="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_result_matrix.NumberOfLinks{numOfLinks}.sif"
    output:
        numLinksTrim="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_result_matrix.NumberOfLinks{numOfLinks}.trimIndirect{trimmingIndirectEdges}.sif"
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/trim_indirect.py {input.numLinks} {trimmingIndirectEdges} {output.numLinksTrim}"

rule CountOutdegreeFdr:
    input:
        fdr="user/{userName}/result/{optionFileName}_Tenet_{fileName}_result_matrix.fdr{cutoffForFdr}.sif"
    output:
        fdrOut="user/{userName}/result/{optionFileName}_Tenet_{fileName}_result_matrix.fdr{cutoffForFdr}.outdegree.txt"
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/countOutdegree.py {input.fdr} {output.fdrOut}"

rule CountOutdegreeNumLinks:
    input:
        numLinks="user/{userName}/result/{optionFileName}_Tenet_{fileName}_result_matrix.NumberOfLinks{numOfLinks}.sif"
    output:
        numLinksOut="user/{userName}/result/{optionFileName}_Tenet_{fileName}_result_matrix.NumberOfLinks{numOfLinks}.outdegree.txt"
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/countOutdegree.py {input.numLinks} {output.numLinksOut}"

rule CountOutdegreeFdrTF:
    input:
        fdr="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_result_matrix.fdr{cutoffForFdr}.sif",
    output:
        fdrOut="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_result_matrix.fdr{cutoffForFdr}.outdegree.txt",
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/countOutdegree.py {input.fdr} {output.fdrOut}"

rule CountOutdegreeNumLinksTF:
    input:
        numLinks="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_result_matrix.NumberOfLinks{numOfLinks}.sif"
    output:
        numLinksOut="user/{userName}/result/{optionFileName}_TenetTF_{fileName}_result_matrix.NumberOfLinks{numOfLinks}.outdegree.txt"
    shell:
        "/opt/conda/envs/snakemake/bin/python /app/workflow/script/TENET/countOutdegree.py {input.numLinks} {output.numLinksOut}"