"use strict";(self["webpackChunkcellcraft_vue"]=self["webpackChunkcellcraft_vue"]||[]).push([[373],{7754:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var s=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"layout"}},[t("div",{staticClass:"side-layout"},[t("div",{staticClass:"setup-layout"},[t("div",{staticClass:"setup-title"},[e._v("Plugin List")]),t("ul",{staticClass:"setup-list"},[e._m(0),e._l(e.plugins,(function(a,s){return t("li",{key:s,staticClass:"setup-item",on:{click:function(t){return e.selectPlugin(a)}}},[t("div",{staticClass:"setup-filename"},[e._v(e._s(a.name))])])}))],2)])]),t("div",{staticClass:"center-layout"},[t("div",{staticClass:"algorithm-layout"},[t("div",{staticClass:"algorithm-select"},[t("div",{staticClass:"algorithm-logo"},[e._v(e._s(e.selectedPlugin.name))])]),t("div",{staticClass:"algorithm-parts"},[e._l(e.selectedPluginRules,(function(a){return t("div",{key:a.name},[t("div",{directives:[{name:"show",rawName:"v-show",value:0!=a.parameters.length,expression:"rule.parameters.length != 0"}],staticClass:"part-title"},[e._v(e._s(a.name))]),e._l(a.parameters,(function(s){return t("div",{directives:[{name:"show",rawName:"v-show",value:0!=a.parameters.length,expression:"rule.parameters.length != 0"}],key:s.name},[t("div",{directives:[{name:"show",rawName:"v-show",value:!("string"===s.type&&"ScatterPlot"===s.name),expression:"!(parameter.type === 'string' && parameter.name === 'ScatterPlot')"}],staticClass:"parameters"},[t("span",{staticClass:"parameter-id"},[e._v(" "+e._s(s.name)+" ")]),"int"===s.type||"float"===s.type?t("input",{directives:[{name:"model",rawName:"v-model",value:s.defaultValue,expression:"parameter.defaultValue"}],staticClass:"parameter__input",attrs:{type:"number",step:s.defaultValue,min:s.min,max:s.max},domProps:{value:s.defaultValue},on:{input:function(t){t.target.composing||e.$set(s,"defaultValue",t.target.value)}}}):"string"===s.type?t("input",{directives:[{name:"model",rawName:"v-model",value:s.defaultValue,expression:"parameter.defaultValue"}],staticClass:"parameter__input",class:{"red-text":!s.defaultValue},attrs:{type:"text"},domProps:{value:s.defaultValue},on:{input:function(t){t.target.composing||e.$set(s,"defaultValue",t.target.value)}}}):"boolean"===s.type?t("input",{directives:[{name:"model",rawName:"v-model",value:s.defaultValue,expression:"parameter.defaultValue"}],staticClass:"parameter__input",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(s.defaultValue)?e._i(s.defaultValue,null)>-1:s.defaultValue},on:{change:function(t){var a=s.defaultValue,l=t.target,i=!!l.checked;if(Array.isArray(a)){var n=null,u=e._i(a,n);l.checked?u<0&&e.$set(s,"defaultValue",a.concat([n])):u>-1&&e.$set(s,"defaultValue",a.slice(0,u).concat(a.slice(u+1)))}else e.$set(s,"defaultValue",i)}}}):"h5adParameter"===s.type?t("div",{staticClass:"parameter__input"},["cell group"===s.name?t("select",{directives:[{name:"model",rawName:"v-model",value:s.defaultValue,expression:"parameter.defaultValue"}],staticClass:"parameter__dropdown",on:{change:[function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(s,"defaultValue",t.target.multiple?a:a[0])},function(t){return e.selectColumns(t)}]}},[t("option",{staticClass:"parameter__menu",attrs:{disabled:"",value:""}},[e._v(" Select Cell Group ")]),e._l(e.annotations,(function(a,s){return t("option",{key:s,staticClass:"parameter__menu",domProps:{value:a}},[e._v(" "+e._s(a)+" ")])}))],2):"clusters"===s.name?t("div",{staticClass:"parameter__dropdown--checkbox",class:{isactive:e.dropdownIsActive},on:{click:e.activateClusters}},[e._v(" Select Clusters "),t("ul",{staticClass:"parameter__dropdown--menu"},e._l(e.clusters,(function(a,l){return t("li",{key:l},[t("label",[t("input",{attrs:{type:"checkbox",name:a},on:{change:function(t){return e.clusterToggle(t,s,a)}}}),e._v(e._s(a))])])})),0)]):"pseudotime"===s.name?t("select",{directives:[{name:"model",rawName:"v-model",value:s.defaultValue,expression:"parameter.defaultValue"}],staticClass:"parameter__dropdown",on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(s,"defaultValue",t.target.multiple?a:a[0])}}},[t("option",{staticClass:"parameter__menu",attrs:{disabled:"",value:""}},[e._v(" Select Pseudotime ")]),e._l(e.pseudotime,(function(a,s){return t("option",{key:s,staticClass:"parameter__menu",domProps:{value:a}},[e._v(" "+e._s(a)+" ")])}))],2):e._e()]):e._e()])])}))],2)})),t("div",{directives:[{name:"show",rawName:"v-show",value:e.allParametersEmpty,expression:"allParametersEmpty"}],staticClass:"algorithm-alert"},[e._v(" No parameters in this plugin. ")])],2)])]),t("div",{staticClass:"side-layout"},[t("div",{staticClass:"setup-layout__node"},[t("div",{staticClass:"setup-title"},[e._v("Plugin Inputs")]),t("ul",{staticClass:"setup-list__node"},e._l(e.selectedPluginInputOutput,(function(a,s){return t("li",{directives:[{name:"show",rawName:"v-show",value:"inputFile"===a.type||"optionalInputFile"===a.type,expression:"item.type === 'inputFile' || item.type === 'optionalInputFile'"}],key:s,staticClass:"setup-item__node",class:{checked:a.activate}},[t("div",{staticClass:"checkbox-wrapper-9"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.activate,expression:"item.activate"}],staticClass:"tgl tgl-flat",attrs:{id:"cb4-9-input-"+s,type:"checkbox",disabled:""},domProps:{checked:Array.isArray(a.activate)?e._i(a.activate,null)>-1:a.activate},on:{change:function(t){var s=a.activate,l=t.target,i=!!l.checked;if(Array.isArray(s)){var n=null,u=e._i(s,n);l.checked?u<0&&e.$set(a,"activate",s.concat([n])):u>-1&&e.$set(a,"activate",s.slice(0,u).concat(s.slice(u+1)))}else e.$set(a,"activate",i)}}}),t("label",{staticClass:"tgl-btn",attrs:{for:"cb4-9-input-"+s}})]),t("div",{staticClass:"setup-filename__node"},[e._v(e._s(a.name))])])})),0)]),t("div",{staticClass:"setup-layout__node"},[t("div",{staticClass:"setup-title"},[e._v("Plugin Outputs")]),t("ul",{staticClass:"setup-list__node"},e._l(e.selectedPluginInputOutput,(function(a,s){return t("li",{directives:[{name:"show",rawName:"v-show",value:"outputFile"===a.type,expression:"item.type === 'outputFile'"}],key:s,staticClass:"setup-item__node",class:{checked:a.activate}},[t("div",{staticClass:"checkbox-wrapper-9"},[t("input",{directives:[{name:"model",rawName:"v-model",value:a.activate,expression:"item.activate"}],staticClass:"tgl tgl-flat",attrs:{id:"cb4-9-output-"+s,type:"checkbox"},domProps:{checked:Array.isArray(a.activate)?e._i(a.activate,null)>-1:a.activate},on:{change:function(t){var s=a.activate,l=t.target,i=!!l.checked;if(Array.isArray(s)){var n=null,u=e._i(s,n);l.checked?u<0&&e.$set(a,"activate",s.concat([n])):u>-1&&e.$set(a,"activate",s.slice(0,u).concat(s.slice(u+1)))}else e.$set(a,"activate",i)}}}),t("label",{staticClass:"tgl-btn",attrs:{for:"cb4-9-output-"+s}})]),t("div",{staticClass:"setup-filename__node"},[e._v(e._s(a.name))])])})),0)])])])},l=[function(){var e=this,t=e._self._c;return t("li",{staticClass:"setup-item"},[t("div",{staticClass:"setup-filename"},[e._v("Plugin Name")])])}],i=(a(4114),a(3375),a(9225),a(3972),a(9209),a(5714),a(7561),a(6197),a(6098)),n={data(){return{annotations:[],pseudotime:[],clusters:[],plugins:[],workflowId:this.$route.query.workflow_id,nodeId:this.$route.query.node,selectedPlugin:null,selectedPluginRules:[],selectedPluginInputOutput:[],currentNodeConnection:[],dropdownIsActive:!1,nodeInfo:{}}},async mounted(){try{this.checkCurrentNodeConnection();const e=await(0,i.xy)();this.plugins=e.data.plugins;const t=this.$store.getters.getWorkflowNodeInfo(this.nodeId);t.data["selectedPlugin"]?this.selectedPlugin=t.data.selectedPlugin:this.plugins.forEach((e=>{e.name===this.nodeInfo.data.title&&(this.selectedPlugin=e)}));const a=this.plugins.find((e=>e.name===this.selectedPlugin.name)),s=this.filterRules(a.rules);t.data["selectedPluginRules"]?this.selectedPluginRules=t.data.selectedPluginRules:this.selectedPluginRules=s.filteredRules,this.selectedPluginInputOutput=this.activatePlugin(s.filteredInputOutput,this.currentNodeConnection),this.selectedPluginInputOutput.some((e=>"inputFile"===e.type&&".h5ad"===e.fileExtension))&&this.loadColumns()}catch(e){console.error(e)}if(this.selectedPlugin){const e={selectedPlugin:{name:this.selectedPlugin.name}},t=this.nodeId;this.$store.commit("setWorkflowNodeDataObject",{nodeId:t,dataObject:e})}if(this.selectedPluginRules){const e={selectedPluginRules:this.selectedPluginRules},t=this.nodeId;this.$store.commit("setWorkflowNodeDataObject",{nodeId:t,dataObject:e})}if(this.selectedPluginInputOutput){const e={selectedPluginInputOutput:this.selectedPluginInputOutput},t=this.nodeId;this.$store.commit("setWorkflowNodeDataObject",{nodeId:t,dataObject:e})}},watch:{selectedPlugin:{handler(e){if(e){const t={selectedPlugin:{name:e.name}},a=this.nodeId;this.$store.commit("setWorkflowNodeDataObject",{nodeId:a,dataObject:t})}},deep:!0},selectedPluginRules:{handler(e){if(e){e.forEach((e=>{e.parameters.forEach((e=>{if("string"===e.type&&"ScatterPlot"===e.name){const t=this.currentNodeConnection.find((e=>"ScatterPlot"===e.class&&e.data.lasso_file_path));t&&(e.defaultValue=t.data.lasso_file_path)}}))}));const t={selectedPluginRules:e},a=this.nodeId;this.$store.commit("setWorkflowNodeDataObject",{nodeId:a,dataObject:t})}},deep:!0},selectedPluginInputOutput:{handler(e){if(e){const t={selectedPluginInputOutput:e},a=this.nodeId;this.$store.commit("setWorkflowNodeDataObject",{nodeId:a,dataObject:t})}},deep:!0}},computed:{allParametersEmpty(){return this.selectedPluginRules.every((e=>0===e.parameters.length))}},methods:{activateClusters(){0!==this.clusters.length?this.dropdownIsActive=!this.dropdownIsActive:alert("There is no cluster column. Please select the cellgroup first.")},async selectColumns(e){const t=e.target.value,a=this.selectedPluginInputOutput.find((e=>"inputFile"===e.type&&".h5ad"===e.fileExtension&&e.activate));if(a){console.log(a);const e=await this.getCurrnetClusters(t);this.clusters=e}},async getCurrnetClusters(e){const t=Object.values(this.$store.getters.getWorkflowNodeFilesInfo(this.nodeId)).find((e=>e.includes(".h5ad")));try{const a=await(0,i.sl)({file_name:t,anno_column:e});return console.log(a.data),a.data.clusters}catch(a){console.error(a)}},activatePlugin(e,t){const a=t.filter((e=>"ResultFile"===e.name)).length;let s=0;return e.map((e=>{let l=!1,i=null;if("inputFile"===e.type||"optionalInputFile"===e.type){const a=t.find((t=>t.data&&t.data.file&&("InputFile"===t.class&&t.data.title&&t.data.title.includes(e.defaultValue)||("DataTable"===t.class||"ScatterPlot"===t.class)&&t.data.file.includes(e.fileExtension))));a&&(l=!0,i=a.data.file)}else"outputFile"===e.type&&s<a&&(l=!0,s++);return{...e,activate:l,file_name:i}}))},checkCurrentNodeConnection(){this.nodeInfo=this.$store.getters.getWorkflowNodeInfo(this.nodeId),console.log(this.nodeInfo),this.nodeInfo.inputs.input_1.connections.forEach((e=>{const t=this.$store.getters.getWorkflowNodeInfo(e.node);this.currentNodeConnection.push(t)})),this.nodeInfo.outputs.output_1.connections.forEach((e=>{const t=this.$store.getters.getWorkflowNodeInfo(e.node);this.currentNodeConnection.push(t)})),console.log(this.currentNodeConnection)},filterUniqueNames(e){const t=e.reduce(((e,t)=>(e[t.name]=(e[t.name]||0)+1,e)),{});return e.filter((e=>1===t[e.name]))},selectPlugin(e){if(confirm("Are you sure you want to select this plugin?")){this.selectedPlugin=e;const t=this.filterRules(this.selectedPlugin.rules);this.$nextTick((()=>{this.selectedPluginRules=t.filteredRules,this.selectedPluginInputOutput=this.activatePlugin(t.filteredInputOutput,this.currentNodeConnection)}))}},filterRules(e){const t=new Set,a=e.filter((e=>!e.isVisualization)).map((e=>{const a=e.parameters.filter((e=>"inputFile"!==e.type&&"optionalInputFile"!==e.type&&"outputFile"!==e.type||(t.add(JSON.stringify(e)),!1)));return{name:e.name,parameters:a}}));return{filteredRules:a,filteredInputOutput:this.filterUniqueNames(Array.from(t).map((e=>JSON.parse(e))))}},clusterToggle(e,t,a){"object"!==typeof t.defaultValue&&(t.defaultValue=[]),e.target.checked?t.defaultValue.push(a):t.defaultValue=t.defaultValue.filter((e=>e!==a)),console.log(t.defaultValue,typeof t.defaultValue)},selectOption(e,t){console.log(e,t),Object.keys(t).forEach((a=>{t[a]=a===e}))},async loadColumns(){const e=this.selectedPluginInputOutput.find((e=>"inputFile"===e.type&&".h5ad"===e.fileExtension&&e.activate));if(e){console.log(e);const a=Object.values(this.$store.getters.getWorkflowNodeFilesInfo(this.nodeId)).find((t=>t.includes(e.fileExtension)));console.log(a);try{const e=await(0,i.GH)({file_name:a});console.log(e.data),this.annotations=e.data.anno_columns,this.pseudotime=e.data.pseudo_columns}catch(t){console.error(t)}}else alert("Please select the input h5ad file.")}}},u=n,o=a(1656),r=(0,o.A)(u,s,l,!1,null,"1d26810f",null),c=r.exports}}]);
//# sourceMappingURL=373.26c092c4.js.map