"use strict";(self["webpackChunkcellcraft_vue"]=self["webpackChunkcellcraft_vue"]||[]).push([[658],{5658:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"layout"}},[t("div",{staticClass:"plotly-layout"},[t("div",{attrs:{id:"plotly-heatmap"}}),e.isLoading?t("div",{staticClass:"loading-layout"},[t("span")]):e.errorOccured?t("div",[t("span",[e._v(" SOME ERROR OCCURED")])]):e.plotReady?e._e():t("div",[t("span",[e._v(" NO DATA FOR HEATMAP")])])]),t("div",{staticClass:"options-layout"},[t("div",{staticClass:"options__item"},[e._v(" sif  "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedSif,expression:"selectedSif"}],staticClass:"options__item__select",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedSif=t.target.multiple?s:s[0]}}},e._l(e.resultSifs,(function(s){return t("option",{key:s,domProps:{value:s}},[e._v(" "+e._s(e._f("splitUnderScore")(s))+" ")])})),0)]),t("div",{staticClass:"options__item"},[e._v(" Degree  "),t("select",{staticClass:"options__item__select",on:{change:function(t){return e.setSelectedDegree(t)}}},e._l(e.numList,(function(s,i){return t("option",{key:i,domProps:{value:s.value}},[e._v(" "+e._s(s.name)+" ")])})),0)]),t("div",{staticClass:"options__item"},[t("button",{attrs:{id:"apply-button"},on:{click:e.applySelect}},[e._v(" "+e._s("Select Apply ")+" ")])])])])},l=[],n=(s(4114),s(6098)),o=s(8933),a=s.n(o),r={data(){return{selectedDegree:0,numList:[{name:"Indegree",value:0},{name:"Outdegree",value:2}],p_min:-7,p_max:7,resultSifs:[],selectedSif:"",current_file:"",expression_file:"",pseudo_time_file:"",cell_select_file:"",plotReady:!1,isLoading:!1,errorOccured:!1}},name:"PlotlyHeatMap",async mounted(){const e=this.$store.getters.getCurrentLinkedNodes;console.log(e[0].algorithmOptions.optionFilePath);try{this.current_file=this.filterAndAddSuffix(this.$store.getters.getCurrentFile.file);const s=await(0,n.zJ)({file_name:this.current_file,option_file_name:e[0].algorithmOptions.optionFilePath}),i=s.data.result_files;console.log(i);for(var t=0;t<i.length;t++){const e=i[t].split("_");e[e.length-1].includes("sif")&&this.resultSifs.push(i[t])}for(t=0;t<this.resultSifs.length;t++)this.resultSifs[t].includes("trimIndirect")&&(this.selectedSif=this.resultSifs[t]);for(t=0;t<i.length;t++)i[t].includes("expMatrix")?(this.expression_file=i[t],console.log(this.expression_file)):i[t].includes("pseudotime")?(this.pseudo_time_file=i[t],console.log(this.pseudo_time_file)):i[t].includes("cellSelect")&&(this.cell_select_file=i[t],console.log(this.cell_select_file))}catch(s){console.log(s)}},filters:{splitUnderScore(e){if(e.includes("_")){const t=e.split("_"),s=t[t.length-1];return s}return e}},methods:{filterAndAddSuffix(e){if(e.includes("_")){const t=e.split("_"),s=t.slice(0,-2).join("_")+".h5ad";return s}return e},async applySelect(){this.isLoading=!0,await this.updatePlot(),this.isLoading=!1},async updatePlot(){try{const _=await(0,n.aw)(this.selectedSif);let g=_.data.split("\n");var e=g.map((function(e){return e.split("\t")})),t={};const m=this.selectedDegree;e.forEach((function(e){var s=e[m];t[s]?t[s]++:t[s]=1})),Object.prototype.hasOwnProperty.call(t,"")&&delete t[""];var s=Object.keys(t).map((function(e){return[e,t[e]]}));s.sort((function(e,t){return e[1]-t[1]}));var i={};s.forEach((function(e){i[e[0]]=e[1]})),Object.prototype.hasOwnProperty.call(i,"undefined")&&delete i["undefined"];const v=await(0,n.aw)(this.expression_file);var l=v.data.split("\n"),o=l.map((function(e){return e.split(",")}));const y=await(0,n.aw)(this.pseudo_time_file),S=y.data.split("\n");for(var r=0;r<S.length;r++)o[r].push(S[r]);const x=await(0,n.aw)(this.cell_select_file),O=x.data.split("\r\n");var c=[],p=o[0];for(r=0;r<o.length;r++)"1"===O[r]&&c.push(o[r+1]);c.sort((function(e,t){return e[e.length-1]-t[t.length-1]}));var u=[];for(r=0;r<Object.keys(i).length;r++){for(var d=p.indexOf(Object.keys(i)[r]),h=[],f=0;f<c.length;f++)h.push(c[f][d+1]);u.push(this.localRegression(h))}console.log(Object.keys(i)),console.log(u);const w=[{y:Object.keys(i),z:u,type:"heatmap",orientation:"h"}],P={width:600,height:570},D={responsive:!0,scrollZoom:!0,displayModeBar:!0,displaylogo:!1};a().newPlot("plotly-heatmap",w,P,D),this.plotReady=!0}catch(_){this.plotReady=!1,this.errorOccured=!0,console.log(_)}console.log(111,this.selectedSif,222,this.current_file,333,this.expression_file,444,this.pseudo_time_file,555,this.cell_select_file)},async setSelectedDegree(e){this.selectedDegree=e.target.value,"string"===typeof this.selectedDegree&&(this.selectedDegree=parseInt(this.selectedDegree))},localRegression(e,t=75){const s=e.length,i=[];for(let r=0;r<s;r++){let l=0,n=0;for(let i=Math.max(0,r-t);i<Math.min(s,r+t+1);i++){const t=1;l+=e[i]*t,n+=t}const o=l/n;i.push(o)}const l=Math.max(...i),n=Math.min(...i),o=l-n;let a=i.map((e=>(e-(l+n)/2)*((this.p_max-this.p_min)/o/10)+(this.p_max+this.p_min)/20));return a},pMinMinus(){this.p_min<=-7||(this.p_min-=1,this.updatePlot(this.selectedDegree))},pMinPlus(){this.p_min>=-1||(this.p_min+=1,this.updatePlot(this.selectedDegree))},pMaxMinus(){this.p_max<=1||(this.p_max-=1,this.updatePlot(this.selectedDegree))},pMaxPlus(){this.p_max>=7||(this.p_max+=1,this.updatePlot(this.selectedDegree))}}},c=r,p=s(1656),u=(0,p.A)(c,i,l,!1,null,"6f640296",null),d=u.exports}}]);
//# sourceMappingURL=658.fc5f68c4.js.map